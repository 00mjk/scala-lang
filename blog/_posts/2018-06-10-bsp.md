---
layout: blog-detail
post-type: blog
by: Jorge Vicente Cantero
title: "Announcing the Build Server Protocol v1.0.0"
---

Ever since I joined the Scala Center, I've dreamt of giving the best
developer experience to all Scala developers no matter what build tools, IDEs
or editors they use.

I've always been convinced that the choice of an editor, IDE or build tool is
personal and, therefore, asking you to go out of your way to learn a new tool
to write Scala is not a viable solution. First, because changing people's
habits is difficult and takes time. Second, it frustrates beginners that just
want to learn the language. Last, it distracts seasoned developers from
writing good Scala code until they master their toolchain. In the worst case,
people will give up and not learn the language because the "cognitive
overhead" would be too high.

Instead it is much better if we, tooling developers, can bear the burden of
shipping tools that integrate with your existing workflow and you, as a user,
can just install them with a quick search and a single click.

Today, I introduce the Build Server Protocol, a project that I believe plays
a fundamental role in bringing us closer to make this vision a reality.

## Any IDE, Any Build Tool

Traditionally, every IDE has implemented a custom integration for each
supported build tool in order to extract build information such as classpaths
or source directories for every project in your build. This information is
necessary for the IDE to present you with a workspace where you can browse,
write and compile Scala code. This process takes place every time you "Import
Project" from the IDE user interface (think IntelliJ or Eclipse).

Likewise, all build tools are expected to integrate with all available IDEs.
Most of them provide "Export Project" capabilities so that user adoption is
not hurt by lack of official IDE support. This support isn't as thorough and
polished as the one provided by IDEs, but usually gets the job done at the
cost of supported features.

The growing number of language servers and build tools in the wider
programming community means tooling developers spend a lot of time working on
these integrations, as this work needs to be duplicated on each side every
time there is a new IDE or build tool. This is especially true in the case of
Scala where there is a lot of activity in the build tools space and new build
tools such as [Bazel], [Pants] and [mill] have started to gain adoption among
Scala developers, making it hard to support them all.

The idea behind the Build Server Protocol is to standardize the protocol for
how build tools (servers) and IDEs (clients) communicate, so a single Build
Server can be re-used in multiple IDEs, and IDEs can support build tools with
minimal effort.

As a result, end users are provided with the best developer experience and
tooling developers can improve the quality of their integrations with less
effort and time, without locking out a part of the Community from good Scala
language support.

### Relationship with the Language Server Protocol

If you have heard of Microsoft's [Language Server Protocol][LSP], you may be
wondering what's the relationship between these two protocols. BSP and LSP
are complementary by design.

While LSP specifies endpoints for communication between an *editor acting as
a client* and a language server, BSP specifies endpoints between a *language
server acting as a client* and a build server.

It turns out that if we want to support Scala across editors like Visual
Studio Code, `vim` or Sublime via a Scala language server, we also need to
integrate with build tools to support features like compiler diagnostics or
code navigation. One of the main focus of BSP is that it can be implemented
alongside LSP.

## The Build Server Protocol v1.0.0

Today I announce version `v1.0.0` of the Build Server Protocol. This version
has been the result of a fruitful collaboration with [Justin
Kaeser][jastice], the [JetBrains] developer responsible for sbt support in
[IntelliJ IDEA].

Justin and I have spent the past months implementing a prototype of the Build
Server Protocol between [IntelliJ IDEA] (client) and [Bloop] (server). The
goal of this prototype was two-fold. On the one hand, we wanted to experience
first-hand the challenges of implementing BSP and learn new insights to
improve the protocol. On the other hand, we wanted to provide Scala
developers a faster "Import Project" that would work across different build
tools *now*, even though build tools don't yet provide implementations of
build servers. Thanks to Bloop, users of [sbt], [mill] or [Maven] ---build
tools that Bloop currently supports--- can try this prototype out.

[BSP v1.0.0](https://github.com/scalacenter/bsp/blob/master/docs/bsp.md)
has been designed to support the most basic language integration in an
IDE/editor. IDEs can find all the modules defined in a workspace, ask for
their dependencies, compile, test, run, and get notifications on modified
build targets, among a few other features.

Our IntelliJ-Bloop implementation doesn't yet implement all these endpoints.
Instead, it focuses on providing a faster integration than the traditional
project import. You can now import your project, browse Scala code with full
language support and get compiler diagnostics from the build tool in
IntelliJ's editor.

How does this work? First, you export your project from your build to Bloop.
This process takes usually ~10s for a medium-sized project (highly
recommended to use [coursier] in your build for upmost speed) and exists so
that Bloop can understand different build tools. Then, the IDE imports it
from Bloop via BSP. In total, the "Import Project" process takes around ~15
seconds.

You can see it on this demo importing [akka/akka](https://github.com/akka/akka/):

![Demo of BSP import for akka/akka](/resources/img/bloop-install.gif)

In my experience, importing a build via BSP is substantially faster than
doing so via the traditional sbt or Maven project import where the process
can take minutes. It also enables smarter communication between build tools
and IDEs because the communication is bidirectional.

Further, this two-step process can be improved in the future. First, bloop
could run `bloopInstall` every time you start up your sbt shell or `reload`
your build. Second, Bloop's Build Server could send notifications the IDE
whenever there is a change in the build. These enhancements would improve the
state-of-the-art in IDE project import by not requiring users to manually
check when the build and IDE have gone off-sync and ask for a "Reload
Project". If sbt implemented BSP, an sbt shell would suffice to also support
a project import with these properties instantly.

Aside from importing your build, the BSP prototype also allows you to get
compiler diagnostics directly from your build tool instead of diagnostics
from IntelliJ's presentation compiler. Build tool diagnostics are always
correct since the compilation happens in your build tool and the results
are streamed to the IDE.

![Demo of BSP compile for akka/akka](/resources/img/bloop-compile.gif)

The BSP integration is now available under an experimental mode in the latest
IntelliJ 2018.2 nightly. To try the prototype out, follow the instructions in
[this
document](https://gist.github.com/jvican/0d738cc0aa47afe5dbbdfe6ea1bd8694).

To learn more about the Build Server Protocol, check out the
[slides](http://jorge.vican.me/slides/BSP.pdf) of my talk with Justin at
Scalasphere 2018.

## Next steps

The next steps will focus on two main areas: adoption and user impact. First,
in order to ease support of all build tools in IntelliJ, the Scala Center
will keep collaborating with Jetbrains to improve IntelliJ's BSP import for
Bloop and other build tools. The goal is to bring BSP import to a
production-ready level where users can benefit from a build-tool-agnostic
import project that is both faster and more reliable.

Second, there is work to do to create a better synergy between build tool
authors and IDE implementors. The [Scala Tooling Protocol Working Group]()
that the Scala Center created a few months ago will help us discuss and
refine the protocol so that all tooling developers in our community can
implement the protocol at scale.

Third, I'd like to collaborate more closely with developers working on Scala
language servers like [Metals] or [Dotty IDE] to bring Scala support to all
editors. There is a big chunk of Scala developers that don't use IntelliJ and
I'd like to make sure that they can benefit from a smooth developer
experience too.

Last but not least, the Build Server Protocol is a language-agnostic protocol
that can be modified to add support for any programming language. Thus, I'd
like to reach out to folks in other programming language communities to find
out ways we can pull our efforts together.

## How to get involved

The best way to share your thoughts on the Build Server Protocol or to get
involved in its development is to open an issue or pull request to
[`scalacenter/bsp`](https://github.com/scalacenter/bsp). Most of the features
in the specification have tickets and review discussions elaborating on the
design goals, like this [closed](https://github.com/scalacenter/bsp/issues/3)
and [open](https://github.com/scalacenter/bsp/issues/14) tickets.

If you want to help integrating BSP in your favorite editor or IDE, or you'd
like to help test the integrations, join our
[`scalacenter/bsp`](https://gitter.im/scalacenter/bsp/) Gitter channel and
let's discuss about ways we can work together.

## Acknoledgements

I'd like to thank my colleague at the Scala Center, Ólafur Páll Geirsson, for
being the co-author of the Build Server Protocol. His help and insights, as
well as his close understanding of [LSP], have been fundamental in designing
a protocol that puts the ergonomics of the clients (IDEs) first.

Finally, I'd like to thank Justin Kaeser and, more broadly, JetBrains for
being part of this initiative. It feels great to collaborate with other
parties to have a positive impact in the tools we provide to the Scala
community.

[sbt]: https://www.scala-sbt.org/
[Maven]: http://maven.apache.org/
[Gradle]: aa
[Bazel]: aa
[Pants]: aa
[mill]: aa
[langservers]: http://langserver.org
[LSP]: https://microsoft.github.io/language-server-protocol/specification
[JetBrains]: https://www.jetbrains.com/
[IntelliJ IDEA]: https://www.jetbrains.com/idea/
[jastice]: https://github.com/jastice
[coursier]: https://github.com/coursier/coursier
[Bloop]: https://github.com/scalacenter/bloop
[Metals]: https://github.com/scalameta/metals
[Dotty IDE]: https://dotty.epfl.ch/docs/usage/ide-support.html